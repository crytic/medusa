package types

import (
	"fmt"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/core/types"
)

// Block represents a rudimentary block structure generated by sending messages to a test chain.
type Block struct {
	// hash represents the block hash for this block.
	hash common.Hash

	// header represents the block header for this current block.
	header *types.Header

	// messages represent internal EVM core.Message objects. Messages are derived from transactions after validation
	// of a transaction occurs and can be thought of as an internal EVM transaction. It contains typical transaction
	// fields plainly (e.g., no transaction signature is included, the sender is derived and simply supplied as a field
	// in a message).
	messages []*CallMessage

	// messageResults represents the results recorded while executing transactions.
	messageResults []*CallMessageResults
}

// NewBlock returns a new Block with the provided parameters.
func NewBlock(blockHash common.Hash, header *types.Header, messages []*CallMessage, messageResults []*CallMessageResults) (*Block, error) {
	// Verify our message count is valid
	if len(messages) != len(messageResults) {
		return nil, fmt.Errorf("cannot created block with %d messages and %d message results. one result should exist per message", len(messages), len(messageResults))
	}

	// Create our block and return it
	block := &Block{
		hash:           blockHash,
		header:         header,
		messages:       messages,
		messageResults: messageResults,
	}
	return block, nil
}

// Hash provides a block hash for the current block.
func (b *Block) Hash() common.Hash {
	return b.hash
}

// Header provides a block hash for the current block.
func (b *Block) Header() *types.Header {
	return b.header
}

// Messages provides the messages (internal transactions) housed in the current block.
func (b *Block) Messages() []*CallMessage {
	return b.messages
}

// MessageResults provides execution results tracked by the chain.TestChain after processing each message in Messages.
func (b *Block) MessageResults() []*CallMessageResults {
	return b.messageResults
}
